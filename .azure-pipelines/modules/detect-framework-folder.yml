## ============================================
## modules/detect-framework-folder.yml
## ============================================
steps:
  - task: PowerShell@2
    name: SetFrameworkStep
    displayName: '‚öôÔ∏è Detect build framework (netX.0-windows*)'
    inputs:
      targetType: 'inline'
      script: |
        $releaseFolder = "$(Build.SourcesDirectory)\$(packageName)\$(packageName)\bin\release"
        
        if (!(Test-Path $releaseFolder)) {
          Write-Error "‚ùå release folder not found: $releaseFolder"
          exit 1
        
          }
       
        $frameworkFolder  = Get-ChildItem -Path $releaseFolder -Directory |
        Sort-Object LastWriteTime -Descending |
        Select-Object -First 1

        if (-not $frameworkFolder) {
          Write-Error "‚ùå Could not extract TargetFramework from release"
          exit 1
        }

        $framework = $frameworkFolder.Name.Trim()
        Write-Host "üì¶ Framework detected: '$framework'"
        # Assignment for the same job
        Write-Host "##vso[task.setvariable variable=releaseOutputFolderName]$framework"
       
        Write-Host "##vso[task.setvariable variable=releaseOutputFolderName;isOutput=true]$framework"
      
