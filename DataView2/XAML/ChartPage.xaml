<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             x:Class="DataView2.XAML.ChartPage"
             xmlns:vms="clr-namespace:DataView2.ViewModels"
             xmlns:lvc="clr-namespace:LiveChartsCore.SkiaSharpView.Maui;assembly=LiveChartsCore.SkiaSharpView.Maui">


    <Grid ColumnDefinitions="1*, 3*">
        <!-- Column 1: Form -->
        <StackLayout Grid.Column="0" Padding="10" Spacing="15" x:Name="StackLayoutChart">
            <Grid ColumnDefinitions="*,*" ColumnSpacing="0">
                <!-- Left Button: Rounded Left Side -->
                <Button Text="Straightedge"
                    Command="{Binding ToggleHighPointSelectionCommand}"
                    BackgroundColor="{Binding DepthPointButtonColor}"
                    TextColor="White"
                    CornerRadius="10"
                    HeightRequest="50"
                    BorderColor="Transparent"
                    Padding="0"
                    Grid.Column="0" />

                <!-- Right Button: Rounded Right Side -->
                <Button Text="Point to Point"
                    Command="{Binding ToggleHighPointSelectionCommand}"
                    BackgroundColor="{Binding ContactPointButtonColor}"
                    TextColor="White"
                    CornerRadius="10"
                    HeightRequest="50"
                    BorderColor="Transparent"
                    Padding="0"
                    Grid.Column="1" />
            </Grid>


            <Label Text="Straight Edge Length (m)" />
            <Entry Placeholder="Enter Straight Edge Length" 
                   Text="{Binding StraightEdgeLengthInput}" 
                   x:Name="SelectedEdgeLengthEntry" />

            <Button Text="Calculate Rutting"
                    Clicked="OnCalculateRuttingButtonClicked" />


            <Label Text="{Binding RuttingValue, StringFormat=' Result : {0:F4} mm '}" 
                     TextColor="DarkGreen" 
                     FontSize="Medium" />


            <Button Text="Add Result" Command="{Binding SaveRuttingCommand}" />

            <ListView x:Name="ruttingResultsListView" ItemsSource="{Binding SavedRuttingResults}">
                <ListView.ItemTemplate>
                    <DataTemplate>
                        <ViewCell>
                            <StackLayout Orientation="Horizontal" Padding="10">
                                <!-- Display the rutting depth -->
                                <Label Text="{Binding RutDepth, StringFormat='Rutting Depth: {0:F4} mm'}" 
                               VerticalOptions="Center" />

                                <!-- Spacer to push the delete button to the right -->
                                <Label HorizontalOptions="FillAndExpand"/>

                                <!-- Delete button -->
                                <Button Text="âŒ"
                                BackgroundColor="Transparent"
                                Command="{Binding BindingContext.DeleteRuttingResultCommand, Source={x:Reference ruttingResultsListView}}"
                                CommandParameter="{Binding .}"
                                VerticalOptions="Center"/>
                            </StackLayout>
                        </ViewCell>
                    </DataTemplate>
                </ListView.ItemTemplate>
            </ListView>


            <Button Text="Save Rutting Results to Table"
                     Command="{Binding SaveRuttingResultsCommand}" />

            <!-- Button to export chart data to CSV -->
            <Button Text="Export to CSV" 
                        Clicked="OnExportButtonClicked"
                        VerticalOptions="End" 
                        HorizontalOptions="Center" />

        </StackLayout>

        <!-- Column 2: Chart -->
        <lvc:CartesianChart
                x:Name="chart"
                Grid.Column="1"
                Series="{Binding Series}"
                Title="{Binding Title}"
                XAxes="{Binding XAxes}"
                YAxes="{Binding YAxes}"
                ZoomMode="X"
                HorizontalOptions="FillAndExpand"
                VerticalOptions="FillAndExpand" />
    </Grid>
</ContentPage>
